{% extends 'includes/base.html' %}
{% load static %}
{% block content %}

                <!-- Begin Page Content -->
                <div class="container-fluid">

                    <!-- Page Heading -->
                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <h1 class="h3 mb-0 text-gray-800">Application</h1>

                    </div>

                    

                    <!-- Content Row -->
                    <div class="row">

                        <!-- Area Chart -->
                        <div class="col-xl-12 col-lg-7">
                            <div class="card shadow mb-4">
                                <!-- Card Header - Dropdown -->
                                <div
                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Applicant</h6>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <form class="p-5 user" method="POST">
                                        {% csrf_token %}

                                        <div class="form-group row">
                                            <label for="first_name" class="col-sm-2 col-form-label">First Name</label>
                                            <div class="col-sm-10 ">
                                                {{ form.first_name }}
                                            </div>
                                        
                                        </div>
                                        <div class="form-group row">
                                            <label for="last_name" class="col-sm-2 col-form-label">Last Name</label>
                                            
                                            <div class="col-sm-10 ">

                                                {{ form.last_name }}

                                            </div>
                                            
                                        </div>
                                        <div class="form-group row">
                                            <label for="district" class="col-sm-2 col-form-label">District</label>
                                            
                                            <div class="col-sm-10 ">
                                                {{ form.district }}

                                            </div>
                                            
                                        </div>
                                        <div class="form-group row">
                                            <label for="place" class="col-sm-2 col-form-label">Place</label>
                                            
                                            <div class="col-sm-10 ">
                                                {{ form.place }}
                                            </div>
                                            
                                        </div>
                                        <div class="form-group row">
                                            <label for="phone_no" class="col-sm-2 col-form-label">Phone Number</label>
                                            
                                            <div class="col-sm-10 ">
                                                {{ form.phone_no }}

                                            </div>
                                            
                                        </div>
                                        <div class="form-group row">
                                            <label for="job" class="col-sm-2 col-form-label">Job</label>
                                            
                                            <div class="col-sm-10 ">
                                                {{ form.job }}

                                            </div>
                                            
                                        </div>
                                        <div class="form-group row">
                                            <label for="cibil_score" class="col-sm-2 col-form-label">Cibil Score</label>
                                            
                                            <div class="col-sm-10 ">
                                                {{ form.cibil_score }}

                                            </div>
                                            
                                        </div>
                                        <div class="form-group row">
                                            <label for="cibil_issue" class="col-sm-2 col-form-label">Cibil Issue</label>
                                            
                                            <div class="col-sm-10 ">
                                                {{ form.cibil_issue }}

                                            </div>
                                            
                                        </div>
                                        <div class="form-group row">
                                            <label for="it_payable" class="col-sm-2 col-form-label">IT Payable</label>
                                            
                                            <div class="col-sm-10">
                                                {% if form.it_payable %}
                                                    Yes
                                                {% else %}
                                                    No
                                                {% endif %}
                                            </div>
                                    
                                        </div>
                                        <div class="form-group row">
                                            <label for="years" class="col-sm-2 col-form-label">Years</label>
                                            
                                            <div class="col-sm-10 ">
                                                {{ form.years }}

                                            </div>
                                            
                                        </div>

                                        <div class="form-group row">
                                            <label for="loan_name" class="col-sm-2 col-form-label">Type of Loan</label>
                                            
                                            <div class="col-sm-10 ">
                                                {{ form.loan_name }}

                                            </div>
                                            
                                        </div>

                                        <div class="form-group row">
                                            <label for="loan_amount" class="col-sm-2 col-form-label">Loan Amount</label>
                                            
                                            <div class="col-sm-10 ">
                                                {{ form.loan_amount }}

                                            </div>
                                            
                                        </div>
                                        <hr>
                                        <h6 class="m-0 font-weight-bold text-primary">Guaranter</h6>
                                        <div class="form-group row">
                                            <label for="guaranter_name" class="col-sm-2 col-form-label">Name</label>
                                            
                                            <div class="col-sm-10 ">
                                                {{ form.guaranter_name }}

                                            </div>
                                            
                                        </div>
                                        <div class="form-group row">
                                            <label for="guaranter_phoneno" class="col-sm-2 col-form-label">Phone Number</label>
                                            
                                            <div class="col-sm-10 ">
                                                {{ form.guaranter_phoneno }}

                                            </div>
                                            
                                        </div>
                                        <div class="form-group row">
                                            <label for="guaranter_job" class="col-sm-2 col-form-label">Job</label>
                                            
                                            <div class="col-sm-10 ">
                                                {{ form.guaranter_job }}

                                            </div>
                                            
                                        </div>
                                        <div class="form-group row">
                                            <label for="guaranter_cibil_score" class="col-sm-2 col-form-label">Cibil Score</label>
                                            
                                            <div class="col-sm-10 ">
                                                {{ form.guaranter_cibil_score }}

                                            </div>
                                            
                                        </div>
                                        <div class="form-group row">
                                            <label for="guaranter_cibil_issue" class="col-sm-2 col-form-label">Cibil Issue</label>
                                            
                                            <div class="col-sm-10 ">
                                                {{ form.guaranter_cibil_issue }}

                                            </div>
                                           
                                        </div>
                                        <hr>
                                        <div class="form-group row">
                                            <label for="followup_date" class="col-sm-2 col-form-label">Follow Up Date</label>
                                            <div class="col-sm-10 ">
                                                {{ form.followup_date }}
                                            </div>
                                        </div>
                                        <!-- New Description Box -->
                                        <div class="form-group row">
                                            <label for="description" class="col-sm-2 col-form-label">Description</label>

                                            <div class="col-sm-10">
                                                {{form.description}}
                                            </div>
                                        </div>
                                        <hr>
                                        <div class="form-group row">
                                            <label for="status_name" class="col-sm-2 col-form-label">Status</label>
                                            <div class="col-sm-10">
                                                {{ form.status_name }}
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label for="application_description" class="col-sm-2 col-form-label">Application Description</label>
                                            <div class="col-sm-10" >
                                             {{form.application_description}}
                                                </div>
                                        </div>
                                        
                                        <div class="form-group row">
                                            <label for="bank_name" class="col-sm-2 col-form-label">Choose Bank</label>
                                            
                                            <div class="col-sm-10 ">
                                                {{form.bank_name}}

                                            </div>
                                            
                                        </div>
                                        <div class="form-group row">
                                            <label for="executive_name" class="col-sm-2 col-form-label">Executive Name</label>
                                            
                                            <div class="col-sm-10 ">
                                                {{form.executive_name}}

                                            </div>
                                            
                                        </div>
                                        <div class="form-group row">
                                            <label for="mobileno_1" class="col-sm-2 col-form-label">Mobile No 1:</label>
                                            
                                            <div class="col-sm-10 ">
                                                {{form.mobileno_1}}

                                            </div>
                                            
                                        </div>
                                        <div class="form-group row">
                                            <label for="mobileno_2" class="col-sm-2 col-form-label">Mobile No 2:</label>
                                            
                                            <div class="col-sm-10 ">
                                                {{form.mobileno_2}}

                                            </div>
                                            
                                        </div>
                                       
                                         
                                        <div class="form-group row">
                                            <label for="assigned_to" class="col-sm-2 col-form-label">Choose User</label>
                                            <div class="col-sm-10">

                                                {{form.assigned_to}}
                                            </div>
                                        </div>
                                        
                                        <input type="submit" name="submit-form" class="btn btn-primary btn-user btn-block d-block mx-auto" value="SUBMIT">
                                        
                                    </form>
                                    <div class="pt-2 pl-5 pr-5 pm-5">

                                        
                                        <h6 class="m-0 font-weight-bold text-primary">Uploaded Files</h6>
                                        <div class="form-group row">
                                            <label for="files" class="col-sm-2 col-form-label">Uploaded files:</label>
                                            <div class="col-sm-10">
                                                {% if files %}
                                                    {% for file in files %}
                                                    <a href="{{file.file.url}}" download>
                                                        {{file.file}}
                                                        <form action="{% url 'delete_files' file.file_id %}"  method="post" style="display:inline;">
                                                            {% csrf_token %}

                                                            <button name="delete-file" type="submit" class="btn" value="delete-file"  onclick="return confirm('Are you sure you want to delete this?');">
                                                                <i class="fa fa-trash-alt" style="color:red; font-size:12px;"></i>
                                                            </button>
                                                        </form>
                                                    </a>
                                                <br/>
                                                    {% endfor %}
                                                {% else %}
                                                    <p>No files uploaded</p>
                                                {% endif %}
                                            </div>
                                            <div class="pl-2" style="display:inline;">
                                            <button id="edit-btn" class=" btn btn-sm btn-primary mb-2">Add Files</button>
                                            <div>
                                                <!-- File upload form for editing, hidden by default -->
                                                <form id="edit-form" method="POST" enctype="multipart/form-data" style="display:none;">
                                                    {% csrf_token %}
                                                    <input type="hidden" name="form_id" value="{{ form.instance.form_id }}">
                                                    <input type="file" name="uploaded_files" class="form-control" required multiple>
                                                    <input type="submit" name="new_files" class="btn btn-primary mt-2" value="Upload New Files">
                                                </form>

                                                <!-- Script to toggle the edit form -->
                                                <script>
                                                    document.getElementById('edit-btn').addEventListener('click', function() {
                                                        var form = document.getElementById('edit-form');
                                                        form.style.display = (form.style.display === 'none') ? 'block' : 'none';
                                                    });
                                                </script>
                                            </div>
                                            </div>
                                        </div>
                                     
                                    </div>

                                </div>
                            </div>
                        </div>

                    </div>




                    <!-- Content Row -->



                </div>
                <!-- /.container-fluid -->

            </div>
    


    <script>
        document.getElementById('add-file-btn').addEventListener('click', function() {
            var fileForm = document.getElementById('file-upload-form');
            if (fileForm.style.display === 'none' || fileForm.style.display === '') {
                fileForm.style.display = 'block';
            } else {
                fileForm.style.display = 'none';
            }
        });
    </script>

<script>
    $(document).ready(function() {
        $('#assigned_to').select2({
            placeholder: "Select users",
            allowClear: true
        });
    });
</script>

{% endblock %}